---
import { ANALYTICS } from 'astrowind:config';

const googleAnalyticsId  = ANALYTICS.vendors.googleAnalytics.id;
---
<script is:inline define:vars={{ googleAnalyticsId }}>
  window.GOOGLE_ANALYTICS_ID = googleAnalyticsId;
</script>
<script async is:inline src={`https://www.googletagmanager.com/gtag/js?id=${googleAnalyticsId}`}></script>

<script>
  declare global {
    interface Window {
      dataLayer: Record<string, any>[];
      gtag: (...args: any[]) => void;
    }
  }

  document.addEventListener("astro:page-load", () => {
    window.dataLayer = window.dataLayer || [];
    window.gtag = function gtag(...args: any[]) {
      window.dataLayer.push(arguments);
    };
    window.gtag("js", new Date());

    window.gtag("consent", "default", {
      ad_storage: "denied",
      ad_user_data: "denied",
      ad_personalization: "denied",
      analytics_storage: "denied",
    });
    window.gtag("config",  window.GOOGLE_ANALYTICS_ID);
  });
</script>
