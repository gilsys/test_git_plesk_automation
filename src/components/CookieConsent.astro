---
import 'vanilla-cookieconsent/dist/cookieconsent.css';
---

<div transition:persist="find-me-on-the-other-side" id="cc-container">
  <button type="button" data-cc="show-preferencesModal"> Show preferences modal </button>

  <script>
    import { run, setLanguage } from 'vanilla-cookieconsent';
    import { config } from '../CookieConsentConfig';
    config.language.default = document.documentElement.getAttribute('lang') || 'es';
    run(config);

    document.addEventListener('astro:after-swap', (event) => {
        setLanguage(document.documentElement.getAttribute('lang')  || 'es');        
    });    
  </script>

  <script is:inline>

    // Restore the `show--consent` class if it was present before the page swap
    document.addEventListener('astro:before-preparation', (event) => {
      const htmlClassName = window.document.documentElement.className;
      const consentClassPresent = htmlClassName.includes('show--consent') ? true : false;
      window._showConsentClass = consentClassPresent;
      
    });

    document.addEventListener('astro:before-swap', (event) => {
      const showConsent = window._showConsentClass ? ` show--consent` : '';
      event.newDocument.documentElement.className += showConsent;
    });
  </script>

</div>
